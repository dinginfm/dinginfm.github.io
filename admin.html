<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dingin FM — Yönetim Paneli</title>
<style>
  body {background:#001829; color:#e6f0ff; font-family:"Segoe UI",sans-serif; margin:0; padding:40px 20px; text-align:center;}
  h1 {color:#ffcc33; font-size:28px; margin-bottom:6px;}
  h2 {color:#a8c0d7; font-weight:normal; margin-bottom:25px;}
  section {background:#022540; border-radius:14px; max-width:900px; margin:0 auto 20px; padding:25px; box-shadow:0 4px 18px rgba(0,0,0,.4);}
  a.btn {display:inline-block; padding:12px 20px; border-radius:10px; background:#003153; color:#ffcc33; text-decoration:none; margin:6px; font-weight:bold;}
  a.btn:hover {background:#ffcc33; color:#001829;}
  .statbox {display:flex; justify-content:space-around; flex-wrap:wrap; gap:14px; margin-top:18px;}
  .stat {background:#003153; padding:12px 18px; border-radius:10px; width:150px;}
  .stat b {color:#ffcc33;}
  footer {color:#9db3c9; font-size:13px; margin-top:40px;}
  ul {list-style:none; padding:0;}
  li {background:#003153; border-radius:8px; padding:8px 10px; margin:6px 0;}
  .pill {display:inline-block; padding:4px 10px; border-radius:20px; font-size:13px;}
  .on {background:#14532d; color:#86efac;}
  .off {background:#7f1d1d; color:#fecaca;}
</style>
</head>
<body>

<h1>🎧 Dingin FM — Yönetim Paneli</h1>
<h2>Sessizliğin Sesi Burada Başlar ☕</h2>

<section>
  <h3>📡 Yayın Durumu <span id="statusPill" class="pill off">OFF AIR</span></h3>
  <div>
    <a class="btn" id="iceLink" target="_blank">Icecast Panelini Aç</a>
    <a class="btn" href="https://dinginfm.github.io/live.html" target="_blank">Canlı Yayın Sayfası</a>
    <button class="btn" onclick="showGuide()">🔴 Canlı Yayına Bağlan</button>
  </div>
  <div class="statbox">
    <div class="stat"><b>Anlık</b><div id="current">0</div></div>
    <div class="stat"><b>Peak</b><div id="peak">0</div></div>
    <div class="stat"><b>Bitrate</b><div id="bitrate">—</div></div>
    <div class="stat"><b>Başlık</b><div id="title">—</div></div>
  </div>
</section>

<section>
  <h3>🎵 Platformlar</h3>
  <a class="btn" href="https://youtube.com" target="_blank">YouTube</a>
  <a class="btn" href="https://spotify.com" target="_blank">Spotify</a>
  <a class="btn" href="https://dinginfm.github.io/podcast.html" target="_blank">Podcast</a>
</section>

<section>
  <h3>📩 Dinleyici Mesajları</h3>
  <ul id="msgList"><li>Henüz mesaj yok...</li></ul>
  <p style="color:#9db3c9;font-size:13px;">Yeni mesaj geldiğinde kısa bir ses duyulur 🔔</p>
</section>

<footer>© 2025 Dingin FM — Sessizliğin Sesi Burada ☕</footer>

<audio id="ping" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

<script>
/* ==== BURASI EN ÖNEMLİ KISIM KUZEN ==== */
/* Buradaki linki NGROK her değiştiğinde yenisiyle değiştir. */
const NGROK_BASE = "https://marcelo-nonrotational-elke.ngrok-free.dev"; // sadece burayı değiştir
/* ====================================== */

const STATUS_JSON = NGROK_BASE + "/status-json.xsl";
const STATUS_XSL = NGROK_BASE + "/status.xsl";
document.getElementById("iceLink").href = STATUS_XSL;

async function updateStats(){
  try {
    const res = await fetch(STATUS_JSON + "?t=" + Date.now());
    const data = await res.json();
    const src = Array.isArray(data.icestats.source) ? data.icestats.source[0] : data.icestats.source;
    document.getElementById("current").textContent = src.listeners ?? 0;
    document.getElementById("peak").textContent = src.listener_peak ?? 0;
    document.getElementById("bitrate").textContent = src.bitrate ? src.bitrate + " kbps" : "—";
    document.getElementById("title").textContent = src.title || "—";
    const pill = document.getElementById("statusPill");
    pill.textContent = src.listeners > 0 ? "ON AIR" : "OFF AIR";
    pill.className = "pill " + (src.listeners > 0 ? "on" : "off");
  } catch(e){
    document.getElementById("statusPill").textContent = "OFF AIR";
    document.getElementById("statusPill").className = "pill off";
  }
}
setInterval(updateStats,15000);
updateStats();

async function loadMessages(){
  try {
    const res = await fetch("messages.json?t=" + Date.now());
    const msgs = await res.json();
    const list = document.getElementById("msgList");
    list.innerHTML = "";
    msgs.forEach(m=>{
      const li=document.createElement("li");
      li.textContent = m.name + ": " + m.text;
      list.appendChild(li);
    });
    document.getElementById("ping").play().catch(()=>{});
  } catch(e){}
}
setInterval(loadMessages,20000);
loadMessages();

function showGuide(){
  alert(`🔴 Yayına Bağlan Rehberi:\n\n1️⃣ Icecast'i başlat.\n2️⃣ Ngrok'u aç (ngrok http 8000)\n3️⃣ Mixxx > Live Broadcasting:\nHost=127.0.0.1\nPort=8000\nMount=/live.mp3\nUser=source\nPassword=icecast.xml'deki\n4️⃣ Sound Hardware:\nMaster Output = VB-Cable Input\nHeadphones = Kulaklık\n5️⃣ Spotify/Chrome çıkışı VB-Cable Output olmalı.`);
}
</script>
</body>
</html>
