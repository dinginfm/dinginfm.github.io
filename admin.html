<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dingin FM â€” YÃ¶netim Paneli</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #031428;
      color: #fff;
      text-align: center;
      padding: 60px 10px;
    }
    h1 {
      color: #ffca28;
      font-size: 26px;
      margin-bottom: 10px;
    }
    h2 {
      color: #80d8ff;
    }
    .panel {
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      padding: 25px;
      margin: 20px auto;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 0 20px rgba(255,255,255,0.1);
    }
    a {
      color: #ffd54f;
      text-decoration: none;
      font-weight: bold;
    }
    a:hover {
      text-decoration: underline;
    }
    ul { text-align: left; list-style: none; padding-left: 0; }
    .pill {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 12px;
      font-weight: bold;
      margin-top: 8px;
    }
    .on { background-color: #00e676; color: #000; }
    .off { background-color: #ff5252; color: #fff; }
    button {
      margin-top: 10px;
      background: #0d47a1;
      border: none;
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover { background: #1565c0; }
    footer {
      margin-top: 40px;
      font-size: 13px;
      color: #ccc;
    }
  </style>
</head>

<body>
  <h1>ğŸ§ Dingin FM â€” YÃ¶netim Paneli</h1>
  <p>SessizliÄŸin Sesi Burada BaÅŸlar â˜•</p>

  <div class="panel">
    <h2>ğŸ“¡ YayÄ±n Durumu</h2>
    <p id="statusText">BaÄŸlantÄ± kontrol ediliyor...</p>
    <span id="statusPill" class="pill off">OFF AIR</span>
    <p id="listeners"></p>
    <p>
      <a id="statusLink" href="#" target="_blank">Icecast YÃ¶netim Panelini AÃ§ (status.xsl)</a>
    </p>
  </div>

  <div class="panel">
    <h2>ğŸ’¬ Dinleyici MesajlarÄ±</h2>
    <ul id="msgList"><li>YÃ¼kleniyor...</li></ul>
  </div>

  <div class="panel">
    <h2>ğŸµ YayÄ±na BaÄŸlan Rehberi</h2>
    <button onclick="showGuide()">AdÄ±mlarÄ± GÃ¶r</button>
  </div>

  <footer>
    Â© 2025 Dingin FM â€” SessizliÄŸin Sesi Burada â˜•<br>
    TÃ¼m yayÄ±n, iÃ§erik ve gÃ¶rsel haklarÄ± saklÄ±dÄ±r.
  </footer>

  <audio id="ping" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

  <script>
    // ğŸ”— NGROK adresini buraya yaz
    const NGROK_BASE = "https://aylak-radio-cat.ngrok-free.dev";

    async function updateStats() {
      try {
        const res = await fetch(`${NGROK_BASE}/status-json.xsl`);
        const data = await res.json();
        const src = data.icestats.source;
        document.getElementById("statusText").textContent = src.server_name || "BaÄŸlandÄ±";
        document.getElementById("listeners").textContent = `ğŸ§ Dinleyiciler: ${src.listeners}`;
        document.getElementById("statusLink").href = `${NGROK_BASE}/status.xsl`;

        const pill = document.getElementById("statusPill");
        if (src.listeners > 0) {
          pill.textContent = "ON AIR";
          pill.className = "pill on";
        } else {
          pill.textContent = "OFF AIR";
          pill.className = "pill off";
        }
      } catch {
        document.getElementById("statusText").textContent = "BaÄŸlantÄ± kurulamadÄ±.";
        document.getElementById("statusPill").textContent = "OFF AIR";
        document.getElementById("statusPill").className = "pill off";
      }
    }

    async function loadMessages() {
      try {
        const res = await fetch("messages.json?t=" + Date.now());
        const msgs = await res.json();
        const list = document.getElementById("msgList");
        list.innerHTML = "";
        msgs.forEach(m => {
          const li = document.createElement("li");
          li.textContent = `${m.name}: ${m.text}`;
          list.appendChild(li);
        });
        if (msgs.length > 0) document.getElementById("ping").play().catch(()=>{});
      } catch {}
    }

    function showGuide() {
      alert(`ğŸ”´ YayÄ±na BaÄŸlan Rehberi:\n\n1ï¸âƒ£ Icecast'i baÅŸlat.\n2ï¸âƒ£ Ngrok'u aÃ§ (ngrok http 8000)\n3ï¸âƒ£ Mixxx > Live Broadcasting:\nHost=127.0.0.1\nPort=8000\nMount=/live.mp3\nUser=source\nPassword=icecast.xml'deki\n4ï¸âƒ£ Sound Hardware:\nMaster Output = VB-Cable Input\nHeadphones = KulaklÄ±k\n5ï¸âƒ£ Spotify/Chrome Ã§Ä±kÄ±ÅŸÄ± VB-Cable Output olmalÄ±.`);
    }

    updateStats();
    loadMessages();
    setInterval(updateStats, 20000);
    setInterval(loadMessages, 25000);
  </script>
</body>
</html>
