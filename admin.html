<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DinginFM â€” DJ Aylak YÃ¶netim Paneli</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ğŸ” Logo arka plan -->
<div class="logo-bg"></div>

<header>
  <h1>ğŸ§ DinginFM â€” DJ Aylak YÃ¶netim Paneli</h1>
  <h2>Sadece YayÄ±ncÄ± Ä°Ã§indir</h2>
</header>

<main>
  <!-- ğŸ”Œ BaÄŸlantÄ± Durumu -->
  <section>
    <h3>ğŸ“¡ YayÄ±n Durumu: <span id="status" style="color:#ff6b6b;">OFF AIR</span></h3>
    <p>Icecast: <span id="icecastStatus">Kontrol ediliyor...</span> | Ngrok: <span id="ngrokStatus">Kontrol ediliyor...</span></p>
    <p>ğŸ™ï¸ Dinleyici: <span id="listeners">0</span> | Bitrate: <span id="bitrate">128 kbps</span> | ÅarkÄ±: <span id="currentSong">Belirtilmedi</span></p>
  </section>

  <!-- ğŸ¶ Medya Ekleme Paneli -->
  <section>
    <h3>ğŸµ Medya YÃ¼kleme</h3>
    <input type="text" id="spotifyLink" placeholder="Spotify linkini yapÄ±ÅŸtÄ±r">
    <button class="btn" onclick="addSpotify()">Spotify Ekle</button>
    <input type="text" id="youtubeLink" placeholder="YouTube linkini yapÄ±ÅŸtÄ±r">
    <button class="btn" onclick="addYouTube()">YouTube Ekle</button>
    <input type="file" id="podcastFile" accept="audio/*">
    <button class="btn" onclick="uploadPodcast()">Podcast YÃ¼kle</button>
  </section>

  <!-- ğŸ“Š YayÄ±n Ä°statistikleri -->
  <section class="stat-box">
    <h3>ğŸ“Š YayÄ±n Ä°statistikleri</h3>
    <table>
      <tr><th>Parametre</th><th>DeÄŸer</th></tr>
      <tr><td>Toplam Dinleyici</td><td id="totalListeners">0</td></tr>
      <tr><td>Peak Dinleyici</td><td id="peakListeners">0</td></tr>
      <tr><td>Toplam YayÄ±n SÃ¼resi</td><td id="totalHours">0 saat</td></tr>
      <tr><td>Son GÃ¼ncelleme</td><td id="lastUpdate">â€”</td></tr>
    </table>
  </section>

  <!-- ğŸ’¬ Mesaj Paneli -->
  <section class="message-box">
    <h3>ğŸ’¬ Dinleyici MesajlarÄ±</h3>
    <form onsubmit="simulateNewMessage(event)">
      <input type="text" id="msgName" placeholder="AdÄ±nÄ±z">
      <textarea id="msgText" placeholder="MesajÄ±nÄ±z..."></textarea>
      <button type="submit" class="btn">GÃ¶nder</button>
    </form>
  </section>
</main>

<footer>
  <p>Â© 2025 DinginFM â€” DJ Aylak Ã–zel YÃ¶netim Paneli</p>
</footer>

<!-- ğŸ”” Bildirim Sesi -->
<audio id="notifySound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_698b8f343e.mp3?filename=notification-1-126505.mp3" preload="auto"></audio>

<script>
let isOnAir = false;
let totalHours = 0;

/* ğŸŸ¢ Icecast & Ngrok baÄŸlantÄ± kontrolÃ¼ */
async function checkConnections() {
  const ice = document.getElementById("icecastStatus");
  const ng = document.getElementById("ngrokStatus");
  try {
    const iceRes = await fetch("http://localhost:8000", { method: "HEAD" });
    ice.textContent = iceRes.ok ? "Aktif ğŸ”µ" : "KapalÄ± ğŸ”´";
    ice.style.color = iceRes.ok ? "#00ff88" : "#ff6b6b";
  } catch {
    ice.textContent = "KapalÄ± ğŸ”´";
    ice.style.color = "#ff6b6b";
  }

  try {
    const ngRes = await fetch("http://127.0.0.1:4040/api/tunnels");
    if (ngRes.ok) {
      const data = await ngRes.json();
      const publicUrl = data.tunnels[0]?.public_url || "KapalÄ±";
      ng.textContent = publicUrl.includes("https") ? "Aktif ğŸ”µ" : "KapalÄ± ğŸ”´";
      ng.style.color = publicUrl.includes("https") ? "#00ff88" : "#ff6b6b";
    } else {
      ng.textContent = "KapalÄ± ğŸ”´";
      ng.style.color = "#ff6b6b";
    }
  } catch {
    ng.textContent = "KapalÄ± ğŸ”´";
    ng.style.color = "#ff6b6b";
  }
}
setInterval(checkConnections, 10000);
checkConnections();

/* ğŸšï¸ YayÄ±n AÃ§ / Kapat */
function toggleBroadcast() {
  const s = document.getElementById("status");
  isOnAir = !isOnAir;
  s.textContent = isOnAir ? "ON AIR" : "OFF AIR";
  s.style.color = isOnAir ? "#00ff88" : "#ff6b6b";
  if (isOnAir) simulateListeners();
}

/* ğŸ‘‚ Dinleyici SimÃ¼lasyonu */
function simulateListeners() {
  const l = document.getElementById("listeners");
  const peakEl = document.getElementById("peakListeners");
  const totalEl = document.getElementById("totalListeners");
  const upd = document.getElementById("lastUpdate");
  const hours = document.getElementById("totalHours");
  const count = Math.floor(Math.random() * 25) + 3;
  l.textContent = count;
  peakEl.textContent = Math.max(count, Number(peakEl.textContent));
  totalEl.textContent = Number(totalEl.textContent) + count;
  totalHours++;
  hours.textContent = totalHours + " saat";
  upd.textContent = new Date().toLocaleTimeString("tr-TR");
}

/* ğŸ”” Mesaj geldiÄŸinde ses Ã§al */
function simulateNewMessage(e) {
  e.preventDefault();
  const name = document.getElementById("msgName").value.trim();
  const msg = document.getElementById("msgText").value.trim();
  if (!name || !msg) {
    alert("LÃ¼tfen ad ve mesaj gir.");
    return;
  }
  const audio = document.getElementById("notifySound");
  audio.currentTime = 0;
  audio.play();
  alert(`ğŸ“¨ ${name} yeni mesaj gÃ¶nderdi:\n"${msg}"`);
  document.getElementById("msgName").value = "";
  document.getElementById("msgText").value = "";
}

/* ğŸ¶ Spotify & YouTube */
function addSpotify() {
  const link = document.getElementById("spotifyLink").value.trim();
  if (link) alert(`ğŸµ Spotify baÄŸlantÄ±sÄ± eklendi:\n${link}`);
  else alert("LÃ¼tfen Spotify linki gir.");
}
function addYouTube() {
  const link = document.getElementById("youtubeLink").value.trim();
  if (link) alert(`ğŸ¬ YouTube baÄŸlantÄ±sÄ± eklendi:\n${link}`);
  else alert("LÃ¼tfen YouTube linki gir.");
}

/* ğŸ™ï¸ Podcast */
function uploadPodcast() {
  const file = document.getElementById("podcastFile").files[0];
  if (file) alert(`ğŸ™ï¸ Podcast yÃ¼klendi: ${file.name}`);
  else alert("Bir dosya seÃ§medin kuzen.");
}
</script>

</body>
</html>
