<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DinginFM — DJ Aylak Yönetim Paneli</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
  background:#001626;
  color:#e6edf3;
  font-family:'Segoe UI',sans-serif;
  text-align:center;
  margin:0;
}
header {
  background:#002743;
  padding:28px 10px;
  box-shadow:0 3px 12px rgba(0,0,0,.6);
}
h1 {color:#ffd43b; margin:0; font-size:28px;}
h2 {color:#9fbdd3; font-weight:normal; font-size:15px; margin-top:6px;}
section {
  max-width:950px;
  margin:25px auto;
  background:#022b47;
  border-radius:14px;
  padding:25px;
}
button {
  border:none;
  border-radius:8px;
  padding:10px 20px;
  margin:10px 5px;
  cursor:pointer;
  font-size:14px;
  transition:0.3s;
}
.offair {background:#b02a37; color:#fff;}
.onair {background:#2fb344; color:#fff;}
.linkbtn {background:#024a7f; color:#e6edf3;}
button:hover {opacity:0.85;}
.stats {
  display:flex;
  justify-content:center;
  gap:20px;
  flex-wrap:wrap;
  margin-bottom:20px;
}
.statbox {
  background:#01385e;
  border-radius:8px;
  padding:12px 18px;
  min-width:120px;
}
.statbox h3 {margin:0; color:#ffd43b; font-size:14px;}
.statbox p {margin:5px 0 0; font-size:15px;}
canvas {margin-top:20px; height:250px !important;}
</style>
</head>
<body>

<header>
  <h1>🎧 DinginFM — DJ Aylak Yönetim Paneli</h1>
  <h2>Sessizliğin Sesi Burada</h2>
</header>

<section>
  <h3>🎙️ Yayın Durumu: <span id="status" class="offair">OFF AIR</span></h3>

  <div class="stats">
    <div class="statbox"><h3>Anlık</h3><p id="listeners">0</p></div>
    <div class="statbox"><h3>Peak</h3><p id="peak">0</p></div>
    <div class="statbox"><h3>Bitrate</h3><p id="bitrate">—</p></div>
    <div class="statbox"><h3>Şarkı</h3><p id="song">—</p></div>
  </div>

  <canvas id="chart"></canvas>

  <div>
    <button class="linkbtn" onclick="window.open('http://localhost:8000','_blank')">🔗 Icecast Paneli</button>
    <button id="toggleBtn" class="offair" onclick="toggleBroadcast()">🔴 Canlı Yayını Durdur</button>
    <button class="linkbtn" onclick="alert('Mesaj kutusu yakında aktif! ☕')">💬 Mesajlar</button>
    <button class="linkbtn" onclick="alert('Platform sayfası yakında eklenecek! 🎧')">🎵 Platformlar</button>
  </div>
</section>

<script>
const STATUS_URL = "http://localhost:8000/status-json.xsl";
const ctx = document.getElementById("chart").getContext("2d");
let chart = new Chart(ctx, {
  type: "line",
  data: {
    labels: [],
    datasets: [{
      label: "Dinleyici Sayısı",
      data: [],
      borderColor: "#ffd43b",
      backgroundColor: "rgba(255, 212, 59, 0.2)",
      tension: 0.4,
      fill: true
    }]
  },
  options: {
    scales: {
      y: {beginAtZero:true, ticks:{color:"#9fbdd3"}},
      x: {ticks:{color:"#9fbdd3"}}
    },
    plugins:{legend:{labels:{color:"#9fbdd3"}}}
  }
});

function updateStats() {
  fetch(STATUS_URL)
    .then(res => res.json())
    .then(data => {
      const source = data.icestats.source || {};
      const listeners = source.listeners || 0;
      const peak = source.listener_peak || 0;
      const bitrate = source.bitrate ? source.bitrate + " kbps" : "—";
      const title = source.title || "—";

      document.getElementById("listeners").textContent = listeners;
      document.getElementById("peak").textContent = peak;
      document.getElementById("bitrate").textContent = bitrate;
      document.getElementById("song").textContent = title;

      // Yayın durumu
      const statusEl = document.getElementById("status");
      const toggleBtn = document.getElementById("toggleBtn");
      if (listeners > 0 || source.bitrate) {
        statusEl.textContent = "ON AIR";
        statusEl.className = "onair";
        toggleBtn.textContent = "🟢 Canlı Yayında";
        toggleBtn.className = "onair";
      } else {
        statusEl.textContent = "OFF AIR";
        statusEl.className = "offair";
        toggleBtn.textContent = "🔴 Canlı Yayını Durdur";
        toggleBtn.className = "offair";
      }

      // Grafiği güncelle
      const time = new Date().toLocaleTimeString();
      chart.data.labels.push(time);
      chart.data.datasets[0].data.push(listeners);
      if (chart.data.labels.length > 15) {
        chart.data.labels.shift();
        chart.data.datasets[0].data.shift();
      }
      chart.update();
    })
    .catch(() => {
      document.getElementById("status").textContent = "OFF AIR";
      document.getElementById("status").className = "offair";
    });
}
function toggleBroadcast() {
  alert("Bu buton yalnızca Mixxx üzerinden yayın kontrolü sağlar 🎶");
}
setInterval(updateStats, 5000);
updateStats();
</script>

</body>
</html>
