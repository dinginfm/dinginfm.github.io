<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DinginFM — DJ Aylak Yönetim Paneli</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- 🔁 Logo arka plan -->
<div class="logo-bg"></div>

<header>
  <h1>🎧 DinginFM — DJ Aylak Yönetim Paneli</h1>
  <h2>Sadece Yayıncı İçindir</h2>
</header>

<main>
  <!-- 🔌 Bağlantı Durumu -->
  <section>
    <h3>📡 Yayın Durumu: <span id="status" style="color:#ff6b6b;">OFF AIR</span></h3>
    <p>Icecast: <span id="icecastStatus">Kontrol ediliyor...</span> | Ngrok: <span id="ngrokStatus">Kontrol ediliyor...</span></p>
    <p>🎙️ Dinleyici: <span id="listeners">0</span> | Bitrate: <span id="bitrate">128 kbps</span> | Şarkı: <span id="currentSong">Belirtilmedi</span></p>
  </section>

  <!-- 🎶 Medya Ekleme Paneli -->
  <section>
    <h3>🎵 Medya Yükleme</h3>
    <input type="text" id="spotifyLink" placeholder="Spotify linkini yapıştır">
    <button class="btn" onclick="addSpotify()">Spotify Ekle</button>
    <input type="text" id="youtubeLink" placeholder="YouTube linkini yapıştır">
    <button class="btn" onclick="addYouTube()">YouTube Ekle</button>
    <input type="file" id="podcastFile" accept="audio/*">
    <button class="btn" onclick="uploadPodcast()">Podcast Yükle</button>
  </section>

  <!-- 📊 Yayın İstatistikleri -->
  <section class="stat-box">
    <h3>📊 Yayın İstatistikleri</h3>
    <table>
      <tr><th>Parametre</th><th>Değer</th></tr>
      <tr><td>Toplam Dinleyici</td><td id="totalListeners">0</td></tr>
      <tr><td>Peak Dinleyici</td><td id="peakListeners">0</td></tr>
      <tr><td>Toplam Yayın Süresi</td><td id="totalHours">0 saat</td></tr>
      <tr><td>Son Güncelleme</td><td id="lastUpdate">—</td></tr>
    </table>
  </section>

  <!-- 💬 Mesaj Paneli -->
  <section class="message-box">
    <h3>💬 Dinleyici Mesajları</h3>
    <form onsubmit="simulateNewMessage(event)">
      <input type="text" id="msgName" placeholder="Adınız">
      <textarea id="msgText" placeholder="Mesajınız..."></textarea>
      <button type="submit" class="btn">Gönder</button>
    </form>
  </section>
</main>

<footer>
  <p>© 2025 DinginFM — DJ Aylak Özel Yönetim Paneli</p>
</footer>

<!-- 🔔 Bildirim Sesi -->
<audio id="notifySound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_698b8f343e.mp3?filename=notification-1-126505.mp3" preload="auto"></audio>

<script>
let isOnAir = false;
let totalHours = 0;

/* 🟢 Icecast & Ngrok bağlantı kontrolü */
async function checkConnections() {
  const ice = document.getElementById("icecastStatus");
  const ng = document.getElementById("ngrokStatus");
  try {
    const iceRes = await fetch("http://localhost:8000", { method: "HEAD" });
    ice.textContent = iceRes.ok ? "Aktif 🔵" : "Kapalı 🔴";
    ice.style.color = iceRes.ok ? "#00ff88" : "#ff6b6b";
  } catch {
    ice.textContent = "Kapalı 🔴";
    ice.style.color = "#ff6b6b";
  }

  try {
    const ngRes = await fetch("http://127.0.0.1:4040/api/tunnels");
    if (ngRes.ok) {
      const data = await ngRes.json();
      const publicUrl = data.tunnels[0]?.public_url || "Kapalı";
      ng.textContent = publicUrl.includes("https") ? "Aktif 🔵" : "Kapalı 🔴";
      ng.style.color = publicUrl.includes("https") ? "#00ff88" : "#ff6b6b";
    } else {
      ng.textContent = "Kapalı 🔴";
      ng.style.color = "#ff6b6b";
    }
  } catch {
    ng.textContent = "Kapalı 🔴";
    ng.style.color = "#ff6b6b";
  }
}
setInterval(checkConnections, 10000);
checkConnections();

/* 🎚️ Yayın Aç / Kapat */
function toggleBroadcast() {
  const s = document.getElementById("status");
  isOnAir = !isOnAir;
  s.textContent = isOnAir ? "ON AIR" : "OFF AIR";
  s.style.color = isOnAir ? "#00ff88" : "#ff6b6b";
  if (isOnAir) simulateListeners();
}

/* 👂 Dinleyici Simülasyonu */
function simulateListeners() {
  const l = document.getElementById("listeners");
  const peakEl = document.getElementById("peakListeners");
  const totalEl = document.getElementById("totalListeners");
  const upd = document.getElementById("lastUpdate");
  const hours = document.getElementById("totalHours");
  const count = Math.floor(Math.random() * 25) + 3;
  l.textContent = count;
  peakEl.textContent = Math.max(count, Number(peakEl.textContent));
  totalEl.textContent = Number(totalEl.textContent) + count;
  totalHours++;
  hours.textContent = totalHours + " saat";
  upd.textContent = new Date().toLocaleTimeString("tr-TR");
}

/* 🔔 Mesaj geldiğinde ses çal */
function simulateNewMessage(e) {
  e.preventDefault();
  const name = document.getElementById("msgName").value.trim();
  const msg = document.getElementById("msgText").value.trim();
  if (!name || !msg) {
    alert("Lütfen ad ve mesaj gir.");
    return;
  }
  const audio = document.getElementById("notifySound");
  audio.currentTime = 0;
  audio.play();
  alert(`📨 ${name} yeni mesaj gönderdi:\n"${msg}"`);
  document.getElementById("msgName").value = "";
  document.getElementById("msgText").value = "";
}

/* 🎶 Spotify & YouTube */
function addSpotify() {
  const link = document.getElementById("spotifyLink").value.trim();
  if (link) alert(`🎵 Spotify bağlantısı eklendi:\n${link}`);
  else alert("Lütfen Spotify linki gir.");
}
function addYouTube() {
  const link = document.getElementById("youtubeLink").value.trim();
  if (link) alert(`🎬 YouTube bağlantısı eklendi:\n${link}`);
  else alert("Lütfen YouTube linki gir.");
}

/* 🎙️ Podcast */
function uploadPodcast() {
  const file = document.getElementById("podcastFile").files[0];
  if (file) alert(`🎙️ Podcast yüklendi: ${file.name}`);
  else alert("Bir dosya seçmedin kuzen.");
}
</script>

</body>
</html>
