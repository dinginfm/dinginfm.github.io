<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DinginFM — DJ Aylak Yönetim Paneli</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
  background:#001626;
  color:#e6edf3;
  font-family:'Segoe UI',sans-serif;
  text-align:center;
  margin:0;
}
header {
  background:#002743;
  padding:28px 10px;
  box-shadow:0 3px 12px rgba(0,0,0,.6);
}
h1 {color:#ffd43b; margin:0; font-size:28px;}
h2 {color:#9fbdd3; font-weight:normal; font-size:15px; margin-top:6px;}
section {
  max-width:950px;
  margin:25px auto;
  background:#022b47;
  border-radius:14px;
  padding:25px;
  box-shadow:0 3px 10px rgba(0,0,0,.4);
}
a.btn, button.btn {
  background:#0d3e66;
  color:#fff;
  border:none;
  border-radius:8px;
  padding:10px 18px;
  margin:6px;
  cursor:pointer;
  text-decoration:none;
  font-weight:bold;
}
a.btn:hover,button.btn:hover {background:#ffd43b; color:#001626;}
.stat {display:inline-block; margin:10px; padding:12px 18px; background:#003153; border-radius:12px;}
.stat b{color:#ffd43b;}
.pill{display:inline-block;padding:5px 12px;border-radius:20px;font-size:13px;}
.on{background:#166534;color:#a7f3d0;}
.off{background:#7f1d1d;color:#fecaca;}
ul{list-style:none;padding:0;margin-top:15px;}
li{background:#003153;border-radius:6px;padding:8px;margin:4px 0;text-align:left;}
footer{color:#9fbdd3;font-size:13px;margin:40px 0;}
canvas{max-width:600px;margin-top:20px;}
.hidden{display:none;}
iframe{width:100%;height:400px;border:none;border-radius:12px;margin-top:15px;}
audio.player { width:80%; margin-top:12px; }
</style>
</head>
<body>
<header>
  <h1>🎧 DinginFM — DJ Aylak Yönetim Paneli</h1>
  <h2>Sessizliğin Sesi Burada ☕</h2>
</header>

<!-- Ana Panel -->
<section id="homePanel">
  <h3>📡 Yayın Durumu <span id="statusPill" class="pill off">OFF AIR</span></h3>
  <div>
    <div class="stat"><b>Anlık:</b> <span id="current">0</span></div>
    <div class="stat"><b>Peak:</b> <span id="peak">0</span></div>
    <div class="stat"><b>Bitrate:</b> <span id="bitrate">—</span></div>
    <div class="stat"><b>Şarkı:</b> <span id="title">—</span></div>
  </div>
  <canvas id="listenerChart"></canvas>
  <br>
  <button class="btn" onclick="openIcecast()">🔗 Icecast Paneli</button>

  <!-- 🎙️ CANLI YAYINA BAĞLAN / DURDUR BUTONU -->
  <button id="liveBtn" class="btn" onclick="toggleLive()">🎙️ Canlı Yayına Bağlan</button>

  <button class="btn" onclick="switchPanel('messages')">💬 Mesajlar</button>
  <button class="btn" onclick="switchPanel('media')">🎵 Platformlar</button>
</section>

<!-- Mesajlar -->
<section id="messagePanel" class="hidden">
  <h3>💬 Dinleyici Mesajları</h3>
  <ul id="msgList"><li>Henüz mesaj yok...</li></ul>
  <button class="btn" onclick="switchPanel('home')">⬅️ Geri</button>
</section>

<!-- Platformlar -->
<section id="mediaPanel" class="hidden">
  <h3>🎵 DJ Aylak Platformları</h3>
  <div>
    <button class="btn" onclick="switchTab('youtubeTab')">YouTube</button>
    <button class="btn" onclick="switchTab('spotifyTab')">Spotify</button>
    <button class="btn" onclick="switchTab('podcastTab')">Podcast</button>
  </div>

  <!-- YouTube -->
  <div id="youtubeTab" class="hidden">
    <h4>🎬 YouTube Alanı</h4>
    <iframe src="https://www.youtube.com/embed?listType=user_uploads&list=SonSatirdanSonra"></iframe>
  </div>

  <!-- Spotify -->
  <div id="spotifyTab" class="hidden">
    <h4>🎧 Spotify Alanı</h4>
    <iframe src="https://open.spotify.com/embed/playlist/37i9dQZF1E4x1R8rA09Tbn"></iframe>
  </div>

  <!-- Podcast -->
  <div id="podcastTab" class="hidden">
    <h4>🎙️ DinginFM Podcast Alanı</h4>
    <p>Kendi ses kayıtlarını dinle:</p>
    <audio class="player" controls>
      <source src="podcast1.mp3" type="audio/mpeg">
      Tarayıcın ses oynatmayı desteklemiyor.
    </audio>
    <audio class="player" controls>
      <source src="podcast2.mp3" type="audio/mpeg">
      Tarayıcın ses oynatmayı desteklemiyor.
    </audio>
    <p>Spotify Podcast:</p>
    <iframe src="https://open.spotify.com/embed/show/3gT3iVn1U2OTwKUVLK7sLH"></iframe>
  </div>

  <button class="btn" onclick="switchPanel('home')">⬅️ Geri</button>
</section>

<audio id="ping" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

<footer>© 2025 DinginFM — DJ Aylak ☕</footer>

<script>
const NGROK_BASE = "https://dinginfm.ngrok-free.dev";
const STATUS_JSON = NGROK_BASE + "/status-json.xsl";
const STATUS_XSL = NGROK_BASE + "/status.xsl";

function openIcecast(){ window.open(STATUS_XSL, "_blank"); }

function switchPanel(p){
  document.getElementById("homePanel").classList.add("hidden");
  document.getElementById("messagePanel").classList.add("hidden");
  document.getElementById("mediaPanel").classList.add("hidden");
  if(p==="home") document.getElementById("homePanel").classList.remove("hidden");
  if(p==="messages") document.getElementById("messagePanel").classList.remove("hidden");
  if(p==="media") document.getElementById("mediaPanel").classList.remove("hidden");
}

function switchTab(tab){
  ["youtubeTab","spotifyTab","podcastTab"].forEach(id=>{
    document.getElementById(id).classList.add("hidden");
  });
  document.getElementById(tab).classList.remove("hidden");
}

const ctx=document.getElementById("listenerChart");
const chart=new Chart(ctx,{
  type:"line",
  data:{labels:[],datasets:[{label:"Dinleyici Sayısı",data:[],borderColor:"#ffd43b",borderWidth:2,fill:false}]},
  options:{scales:{y:{beginAtZero:true}}}
});

async function updateStats(){
  try{
    const res=await fetch(STATUS_JSON+"?t="+Date.now());
    const data=await res.json();
    const src=Array.isArray(data.icestats.source)?data.icestats.source[0]:data.icestats.source;
    document.getElementById("current").textContent=src.listeners??0;
    document.getElementById("peak").textContent=src.listener_peak??0;
    document.getElementById("bitrate").textContent=src.bitrate?src.bitrate+" kbps":"—";
    document.getElementById("title").textContent=src.title||"—";
    const pill=document.getElementById("statusPill");
    pill.textContent=src.listeners>0?"ON AIR":"OFF AIR";
    pill.className="pill "+(src.listeners>0?"on":"off");
    chart.data.labels.push(new Date().toLocaleTimeString());
    chart.data.datasets[0].data.push(src.listeners??0);
    if(chart.data.labels.length>12){chart.data.labels.shift();chart.data.datasets[0].data.shift();}
    chart.update();
  }catch(e){
    document.getElementById("statusPill").textContent="OFF AIR";
  }
}

async function loadMessages(){
  try{
    const res=await fetch("messages.json?t="+Date.now());
    const msgs=await res.json();
    const list=document.getElementById("msgList");
    list.innerHTML="";
    msgs.forEach(m=>{
      const li=document.createElement("li");
      li.textContent=m.name+": "+m.text;
      list.appendChild(li);
    });
    document.getElementById("ping").play().catch(()=>{});
  }catch(e){}
}

// 🎙️ Canlı Yayına Bağlan / Durdur butonu
let liveOn = false;
function toggleLive(){
  const btn = document.getElementById("liveBtn");
  if(!liveOn){
    btn.textContent = "⏹️ Canlı Yayını Durdur";
    btn.style.background = "#7f1d1d";
    alert("🎙️ Mixxx üzerinden yayına bağlanabilirsiniz!\n(Host=127.0.0.1 / Port=8000 / Mount=/live.mp3)");
    liveOn = true;
  }else{
    btn.textContent = "🎙️ Canlı Yayına Bağlan";
    btn.style.background = "#0d3e66";
    liveOn = false;
  }
}

setInterval(updateStats,15000);
setInterval(loadMessages,20000);
updateStats();
loadMessages();
</script>
</body>
</html>
