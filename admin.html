<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DinginFM â€” DJ Aylak YÃ¶netim Paneli</title>
<link rel="stylesheet" href="style.css">
<style>
body {
  margin: 0;
  background: #001626;
  color: #e6edf3;
  font-family: 'Segoe UI', sans-serif;
  text-align: center;
  overflow-x: hidden;
}
.logo-bg {
  position: fixed;
  inset: 0;
  background: url('assets/logo.png') center/cover no-repeat;
  opacity: 0.08;
  z-index: 0;
}
header {
  background: rgba(0,39,67,0.85);
  padding: 25px 10px;
  box-shadow: 0 3px 10px rgba(0,0,0,.5);
  position: relative;
  z-index: 1;
}
h1 { color:#ffd43b; margin-bottom:5px; }
h2 { color:#9fbdd3; font-weight:normal; margin:0 0 20px 0; }
main { position:relative; z-index:1; max-width:800px; margin:0 auto; }
section {
  background: rgba(2,43,71,0.75);
  margin:20px;
  padding:20px;
  border-radius:10px;
  box-shadow:0 4px 12px rgba(0,0,0,.4);
}
.btn {
  background:#ffd43b;
  color:#001626;
  border:none;
  padding:10px 16px;
  border-radius:6px;
  cursor:pointer;
  font-weight:bold;
  margin-top:10px;
  transition:0.3s;
}
.btn:hover { background:#ffea84; }
.status.on { color:#5cff75; font-weight:bold; }
.status.off { color:#ff5555; font-weight:bold; }
footer {
  background:rgba(0,39,67,0.85);
  padding:15px;
  color:#9fbdd3;
  margin-top:40px;
  box-shadow:0 -2px 10px rgba(0,0,0,.4);
}
</style>
</head>
<body>

<div class="logo-bg"></div>

<header>
  <h1>ğŸ§ DinginFM â€” DJ Aylak YÃ¶netim Paneli</h1>
  <h2>SessizliÄŸin Sesi Burada</h2>
</header>

<main>
  <!-- YayÄ±n Durumu -->
  <section>
    <h3>ğŸ“¡ YayÄ±n Durumu: <span id="status-info" class="status off">Kontrol ediliyor...</span></h3>
    <p>AnlÄ±k Dinleyici: <span id="listener-count">0</span> | Peak: <span id="peak-count">0</span> | Bitrate: <span id="bitrate">â€”</span></p>
    <button id="toggleBtn" class="btn" onclick="startBroadcast()">YayÄ±nÄ± AÃ§ / Kapat</button>
  </section>

  <!-- Medya YÃ¼kleme -->
  <section>
    <h3>ğŸµ Medya YÃ¼kleme</h3>
    <input type="text" id="spotify" placeholder="Spotify linkini yapÄ±ÅŸtÄ±r"><br>
    <button class="btn" onclick="openSpotify()">Spotify Ekle</button><br><br>
    <input type="text" id="youtube" placeholder="YouTube linkini yapÄ±ÅŸtÄ±r"><br>
    <button class="btn" onclick="openYouTube()">YouTube Ekle</button><br><br>
    <input type="file" id="podcastFile"><br>
    <button class="btn" onclick="uploadPodcast()">Podcast YÃ¼kle</button>
  </section>

  <!-- YayÄ±n Ä°statistikleri -->
  <section>
    <h3>ğŸ“Š YayÄ±n Ä°statistikleri</h3>
    <table style="width:100%;color:#cfe0ea">
      <tr><th>Parametre</th><th>DeÄŸer</th></tr>
      <tr><td>Toplam Dinleyici</td><td id="totalListeners">0</td></tr>
      <tr><td>Peak Dinleyici</td><td id="peakListeners">0</td></tr>
      <tr><td>Toplam YayÄ±n SÃ¼resi</td><td id="totalHours">0 saat</td></tr>
      <tr><td>Son GÃ¼ncelleme</td><td id="lastUpdate">â€”</td></tr>
    </table>
  </section>

  <!-- Dinleyici MesajlarÄ± -->
  <section>
    <h3>ğŸ’¬ Dinleyici MesajlarÄ±</h3>
    <ul id="messageList" style="list-style:none;padding:0;color:#cfe0ea"></ul>
  </section>
</main>

<footer>
  Â© 2025 DinginFM â€” TÃ¼m yayÄ±n ve iÃ§erik haklarÄ± saklÄ±dÄ±r. ğŸ™ï¸ "Burada sessizliÄŸin sesi var."
</footer>

<audio id="msgSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
// ğŸ§ Icecast Durumu
async function checkIcecastStatus() {
  const status = document.getElementById("status-info");
  try {
    const res = await fetch("/status-json.xsl", {cache:"no-store"});
    const data = await res.json();
    let src = data?.icestats?.source;
    if (Array.isArray(src)) src = src.find(s => s.listenurl?.includes("/live"));
    const active = !!src;
    document.getElementById("listener-count").textContent = src?.listeners || 0;
    document.getElementById("peak-count").textContent = src?.listener_peak || 0;
    document.getElementById("bitrate").textContent = src?.bitrate ? src.bitrate + " kbps" : "â€”";
    status.textContent = active ? "ğŸ”µ Aktif" : "ğŸ”´ KapalÄ±";
    status.className = "status " + (active ? "on" : "off");
    document.getElementById("lastUpdate").textContent = new Date().toLocaleTimeString("tr-TR");
  } catch {
    status.textContent = "ğŸ”´ KapalÄ±";
    status.className = "status off";
  }
}
setInterval(checkIcecastStatus, 5000);
checkIcecastStatus();

// ğŸ¶ Buton Ä°ÅŸlevleri
function openSpotify(){const l=document.getElementById('spotify').value;if(l)window.open(l);else alert('Spotify linki boÅŸ!');}
function openYouTube(){const l=document.getElementById('youtube').value;if(l)window.open(l);else alert('YouTube linki boÅŸ!');}
function uploadPodcast(){const f=document.getElementById('podcastFile').files[0];alert(f?`ğŸ™ï¸ Podcast "${f.name}" yÃ¼klendi.`:'LÃ¼tfen dosya seÃ§in.');}

function startBroadcast(){
  alert("ğŸ§ YayÄ±n baÅŸlatÄ±lÄ±yor... (SimÃ¼lasyon)");
  document.getElementById("toggleBtn").style.background="#6cf";
}

// ğŸ’¬ Formspree + LocalStorage mesaj senkronu
const FORM_URL = "https://formspree.io/f/XXXXYYYY"; // kendi linkini koy

async function loadMessages() {
  const listEl = document.getElementById("messageList");
  listEl.innerHTML = "â³ Mesajlar yÃ¼kleniyor...";
  try {
    const res = await fetch(FORM_URL + ".json");
    if (res.ok) {
      const data = await res.json();
      listEl.innerHTML = "";
      data.forEach(m => {
        const li = document.createElement("li");
        li.textContent = `ğŸ“© ${m.name}: ${m.message}`;
        listEl.appendChild(li);
      });
    } else renderLocalMessages();
  } catch {
    renderLocalMessages();
  }
}

// ğŸ’¾ LocalStorage yedeÄŸi
function renderLocalMessages(){
  const data = JSON.parse(localStorage.getItem("dinginfm_messages")||"[]");
  const listEl = document.getElementById("messageList");
  listEl.innerHTML = "";
  if (!data.length) return listEl.innerHTML = "HenÃ¼z mesaj yok.";
  data.forEach(m=>{
    const li=document.createElement("li");
    li.textContent=`ğŸ“© ${m.name}: ${m.message}`;
    listEl.appendChild(li);
  });
}

loadMessages();
setInterval(loadMessages,30000);
</script>
</body>
</html>
