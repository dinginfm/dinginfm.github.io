<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DinginFM Yönetim Paneli</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { background:#001828; color:#dce7f5; font-family:'Segoe UI',sans-serif; text-align:center; margin:0; padding:0; }
header { padding:30px 0 10px; background:#00253e; box-shadow:0 4px 10px rgba(0,0,0,.5);}
h1 {color:#ffcc33; margin:0; font-size:26px;}
h2 {color:#9fbdd3; font-weight:normal; font-size:15px;}
section {max-width:900px; margin:25px auto; background:#022b47; border-radius:14px; padding:25px; box-shadow:0 3px 10px rgba(0,0,0,.4);}
a.btn,button.btn {background:#0d3e66; color:#fff; border:none; border-radius:8px; padding:10px 18px; margin:6px; cursor:pointer; text-decoration:none; font-weight:bold;}
a.btn:hover,button.btn:hover {background:#ffcc33; color:#001828;}
.stat {display:inline-block; margin:10px; padding:12px 18px; background:#003153; border-radius:12px;}
.stat b{color:#ffcc33;}
.pill{display:inline-block;padding:5px 12px;border-radius:20px;font-size:13px;}
.on{background:#166534;color:#a7f3d0;}
.off{background:#7f1d1d;color:#fecaca;}
ul{list-style:none;padding:0;margin-top:15px;}
li{background:#003153;border-radius:6px;padding:8px;margin:4px 0;text-align:left;}
footer{color:#8ea6c4;font-size:13px;margin:40px 0;}
canvas{max-width:600px;margin-top:20px;}
.hidden { display:none; }
iframe {width:100%; height:400px; border:none; border-radius:12px; margin-top:15px;}
</style>
</head>
<body>
<header>
  <h1>🎧 DinginFM — Yönetim Paneli</h1>
  <h2>Sessizliğin Sesi Burada ☕</h2>
</header>

<section id="homeSection">
  <h3>📡 Yayın Durumu <span id="statusPill" class="pill off">OFF AIR</span></h3>
  <div>
    <div class="stat"><b>Anlık:</b> <span id="current">0</span></div>
    <div class="stat"><b>Peak:</b> <span id="peak">0</span></div>
    <div class="stat"><b>Bitrate:</b> <span id="bitrate">—</span></div>
    <div class="stat"><b>Şarkı:</b> <span id="title">—</span></div>
  </div>
  <canvas id="listenerChart"></canvas>
  <br>
  <button class="btn" id="iceBtn">🔗 Icecast Paneli</button>
  <button class="btn" onclick="showGuide()">🎙️ Yayına Bağlan</button>
  <button class="btn" onclick="showSection('messagesSection')">💬 Mesajlar</button>
  <button class="btn" onclick="showSection('mediaSection')">🎵 Platformlar</button>
</section>

<section id="messagesSection" class="hidden">
  <h3>💬 Dinleyici Mesajları</h3>
  <ul id="msgList"><li>Henüz mesaj yok...</li></ul>
  <button class="btn" onclick="showSection('homeSection')">⬅️ Geri</button>
</section>

<section id="mediaSection" class="hidden">
  <h3>🎵 Platformlar</h3>
  <button class="btn" onclick="showTab('youtube')">YouTube</button>
  <button class="btn" onclick="showTab('spotify')">Spotify</button>
  <button class="btn" onclick="showTab('podcast')">Podcast</button>
  
  <div id="youtube" class="mediaTab hidden">
    <h4>🎬 YouTube Paneli</h4>
    <iframe src="https://www.youtube.com/embed?listType=user_uploads&list=SonSatirdanSonra"></iframe>
  </div>
  
  <div id="spotify" class="mediaTab hidden">
    <h4>🎧 Spotify Paneli</h4>
    <iframe src="https://open.spotify.com/embed/playlist/37i9dQZF1E4x1R8rA09Tbn"></iframe>
  </div>
  
  <div id="podcast" class="mediaTab hidden">
    <h4>🎙️ DinginFM Podcast</h4>
    <iframe src="podcast.html"></iframe>
  </div>

  <button class="btn" onclick="showSection('homeSection')">⬅️ Geri</button>
</section>

<audio id="ping" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

<footer>© 2025 DinginFM — SonSatırdanSonra Prodüksiyon ☕</footer>

<script>
const NGROK_BASE = "https://aylak-radio-cat.ngrok-free.dev";
const STATUS_JSON = NGROK_BASE + "/status-json.xsl";
const STATUS_XSL = NGROK_BASE + "/status.xsl";
document.getElementById("iceBtn").onclick = () => window.open(STATUS_XSL, "_blank");

let chartData = [];
const ctx = document.getElementById("listenerChart");
const chart = new Chart(ctx, {
  type:"line",
  data:{labels:[], datasets:[{label:"Dinleyici Sayısı",data:[],borderColor:"#ffcc33",borderWidth:2,fill:false}]},
  options:{scales:{y:{beginAtZero:true}}}
});

function showSection(id){
  document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}
function showTab(id){
  document.querySelectorAll(".mediaTab").forEach(t=>t.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

async function updateStats(){
  try{
    const res = await fetch(STATUS_JSON + "?t=" + Date.now());
    const data = await res.json();
    const src = Array.isArray(data.icestats.source)?data.icestats.source[0]:data.icestats.source;
    document.getElementById("current").textContent = src.listeners ?? 0;
    document.getElementById("peak").textContent = src.listener_peak ?? 0;
    document.getElementById("bitrate").textContent = src.bitrate?src.bitrate+" kbps":"—";
    document.getElementById("title").textContent = src.title || "—";
    const pill=document.getElementById("statusPill");
    pill.textContent=src.listeners>0?"ON AIR":"OFF AIR";
    pill.className="pill "+(src.listeners>0?"on":"off");
    chart.data.labels.push(new Date().toLocaleTimeString());
    chart.data.datasets[0].data.push(src.listeners??0);
    if(chart.data.labels.length>12){chart.data.labels.shift();chart.data.datasets[0].data.shift();}
    chart.update();
  }catch(e){document.getElementById("statusPill").textContent="OFF AIR";}
}

async function loadMessages(){
  try{
    const res=await fetch("messages.json?t="+Date.now());
    const msgs=await res.json();
    const list=document.getElementById("msgList");
    list.innerHTML="";
    msgs.forEach(m=>{
      const li=document.createElement("li");
      li.textContent=m.name+": "+m.text;
      list.appendChild(li);
    });
    document.getElementById("ping").play().catch(()=>{});
  }catch(e){}
}

function showGuide(){
  alert(`🎙️ DinginFM Yayına Bağlanma Rehberi:
1️⃣ Icecast’i başlat
2️⃣ Ngrok'u aç (ngrok http 8000)
3️⃣ Mixxx > Live Broadcasting:
   Host=127.0.0.1
   Port=8000
   Mount=/live.mp3
   User=source
   Password=icecast.xml'deki
4️⃣ Sound Hardware:
   Master Output = VB-Cable Input
   Headphones = Kulaklık
5️⃣ Spotify/Chrome çıkışı = VB-Cable Output`);
}

setInterval(updateStats,15000);
setInterval(loadMessages,20000);
updateStats();
loadMessages();
</script>
</body>
</html>
