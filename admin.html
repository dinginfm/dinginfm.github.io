<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DinginFM â€” DJ Aylak YÃ¶netim Paneli</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="logo-bg"></div>

<header>
  <h1>ğŸ§ DinginFM â€” DJ Aylak YÃ¶netim Paneli</h1>
  <h2>SessizliÄŸin Sesi Burada</h2>
</header>

<main>
  <!-- YayÄ±n Durumu -->
  <section>
    <h3>ğŸ“¡ YayÄ±n Durumu: <span id="status-info" class="status">Kontrol ediliyor...</span></h3>
    <p>AnlÄ±k Dinleyici: <span id="listener-count">0</span> | Peak: <span id="peak-count">0</span> | Bitrate: 128 kbps</p>
    <button class="btn" onclick="startBroadcast()">YayÄ±nÄ± AÃ§ / Kapat</button>
  </section>

  <!-- Medya YÃ¼kleme -->
  <section>
    <h3>ğŸµ Medya YÃ¼kleme</h3>
    <input type="text" id="spotify" placeholder="Spotify linkini yapÄ±ÅŸtÄ±r">
    <button class="btn" onclick="openSpotify()">Spotify Ekle</button><br>
    <input type="text" id="youtube" placeholder="YouTube linkini yapÄ±ÅŸtÄ±r">
    <button class="btn" onclick="openYouTube()">YouTube Ekle</button><br>
    <input type="file" id="podcastFile">
    <button class="btn" onclick="uploadPodcast()">Podcast YÃ¼kle</button>
  </section>

  <!-- YayÄ±n Ä°statistikleri -->
  <section class="stat-box">
    <h3>ğŸ“Š YayÄ±n Ä°statistikleri</h3>
    <table>
      <tr><th>Parametre</th><th>DeÄŸer</th></tr>
      <tr><td>Toplam Dinleyici</td><td id="totalListeners">0</td></tr>
      <tr><td>Peak Dinleyici</td><td id="peakListeners">0</td></tr>
      <tr><td>Toplam YayÄ±n SÃ¼resi</td><td id="totalHours">0 saat</td></tr>
      <tr><td>Son GÃ¼ncelleme</td><td id="lastUpdate">â€”</td></tr>
    </table>
  </section>

  <!-- Dinleyici MesajlarÄ± -->
  <section class="message-box">
    <h3>ğŸ’¬ Dinleyici MesajlarÄ±</h3>
    <form onsubmit="sendMessage(event)">
      <input type="text" id="name" placeholder="AdÄ±nÄ±z" required>
      <textarea id="message" placeholder="MesajÄ±nÄ±z..." required></textarea>
      <button type="submit" class="btn">GÃ¶nder</button>
    </form>
  </section>

</main>

<footer>
  Â© 2025 DinginFM â€” TÃ¼m yayÄ±n ve iÃ§erik haklarÄ± saklÄ±dÄ±r.  
  ğŸ™ï¸ "Burada sessizliÄŸin sesi var."
</footer>

<audio id="msgSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<script>
// --- Spotify ve YouTube baÄŸlantÄ±larÄ± ---
function openSpotify() {
  const link = document.getElementById('spotify').value;
  if (link) window.open(link, '_blank');
  else alert('Spotify linki boÅŸ olamaz!');
}
function openYouTube() {
  const link = document.getElementById('youtube').value;
  if (link) window.open(link, '_blank');
  else alert('YouTube linki boÅŸ olamaz!');
}
function uploadPodcast() {
  const file = document.getElementById('podcastFile').files[0];
  if (file) alert(`ğŸ™ï¸ Podcast "${file.name}" yÃ¼klendi (Ã¶rnek simÃ¼lasyon).`);
  else alert('LÃ¼tfen bir dosya seÃ§in.');
}

// --- Icecast Durum KontrolÃ¼ ---
async function checkIcecastStatus() {
  const statusElement = document.getElementById("status-info");
  try {
    const res = await fetch("http://localhost:8000/status-json.xsl");
    if (!res.ok) throw new Error("BaÄŸlantÄ± yok");
    const data = await res.json();
    const src = data.icestats.source || {};
    document.getElementById("listener-count").innerText = src.listeners || 0;
    document.getElementById("peak-count").innerText = src.listener_peak || 0;
    statusElement.innerHTML = "ğŸ”µ Aktif";
    statusElement.classList.add("onair");
  } catch {
    statusElement.innerHTML = "ğŸ”´ KapalÄ±";
    statusElement.classList.remove("onair");
  }
}
setInterval(checkIcecastStatus, 5000);
checkIcecastStatus();

// --- YayÄ±nÄ± AÃ§/Kapat Komutu (SimÃ¼lasyon) ---
function startBroadcast() {
  alert("ğŸ§ YayÄ±n baÅŸlatÄ±lÄ±yor... Icecast ve Ngrok Ã§alÄ±ÅŸtÄ±rÄ±lmalÄ±!");
}

// --- Mesaj Bildirimi ---
function sendMessage(event) {
  event.preventDefault();
  const name = document.getElementById("name").value;
  const msg = document.getElementById("message").value;
  if (name && msg) {
    document.getElementById("msgSound").play();
    alert(`ğŸ“© ${name}: ${msg}`);
  }
}
</script>

</body>
</html>
