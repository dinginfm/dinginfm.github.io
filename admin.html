<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dingin FM â€” YÃ¶netim Paneli</title>
  <link rel="stylesheet" href="stil.css">
</head>
<body>
  <section id="admin-panel" style="text-align:center; margin-top:80px;">
    <h1>ğŸ§ Dingin FM â€” YÃ¶netim Paneli</h1>
    <p>SessizliÄŸin Sesi Burada BaÅŸlar â˜•</p>

    <div id="statusBox" style="margin:20px auto; padding:20px; width:50%; background:#0a1b2b; border-radius:10px;">
      <h2>ğŸ“¡ YayÄ±n Durumu</h2>
      <p id="statusPill" class="pill off">OFF AIR</p>
      <p>Dinleyici SayÄ±sÄ±: <span id="listenerCount">0</span></p>
      <p><a id="statusLink" href="#" target="_blank" style="color:#facc15;">Icecast YÃ¶netim Panelini AÃ§</a></p>
    </div>

    <div id="messagesBox" style="margin:40px auto; width:60%; background:#0a1b2b; border-radius:10px; padding:15px;">
      <h3>ğŸ’¬ Dinleyici MesajlarÄ±</h3>
      <ul id="msgList" style="list-style:none; padding:0; color:#ddd; font-size:14px;"></ul>
    </div>

    <div id="linksBox" style="margin-top:30px;">
      <h3>ğŸµ YayÄ±n PlatformlarÄ±</h3>
      <a href="https://open.spotify.com" target="_blank" style="color:#1DB954;">Spotify</a> |
      <a href="https://www.youtube.com" target="_blank" style="color:#FF0000;">YouTube</a> |
      <a href="podcast.html" style="color:#facc15;">Podcast</a>
    </div>

    <p style="margin-top:40px; font-size:12px; color:#aaa;">
      Â© 2025 Dingin FM â€” SessizliÄŸin Sesi Burada â˜•<br>
      TÃ¼m yayÄ±n, iÃ§erik ve gÃ¶rsel haklarÄ± saklÄ±dÄ±r.
    </p>
  </section>

  <audio id="ping" src="assets/ping.mp3" preload="auto"></audio>

  <script>
    // ğŸŒ Ngrok adresini buradan deÄŸiÅŸtir (her tÃ¼nel yenilendiÄŸinde)
    const NGROK_BASE = "https://dinginfm.ngrok-free.dev";

    // ğŸ”„ Icecast durumunu gÃ¼ncelle
    async function updateStats() {
      try {
        const res = await fetch(`${NGROK_BASE}/status-json.xsl`);
        const data = await res.json();
        const src = data.icestats.source;
        const pill = document.getElementById("statusPill");
        const listeners = src.listeners || 0;

        document.getElementById("listenerCount").textContent = listeners;
        document.getElementById("statusLink").href = `${NGROK_BASE}/status.xsl`;

        if (listeners > 0) {
          pill.textContent = "ON AIR ğŸ™ï¸";
          pill.className = "pill on";
        } else {
          pill.textContent = "OFF AIR";
          pill.className = "pill off";
        }
      } catch (e) {
        document.getElementById("statusPill").textContent = "OFFLINE âŒ";
        document.getElementById("statusPill").className = "pill off";
      }
    }

    setInterval(updateStats, 15000);
    updateStats();

    // ğŸ’¬ MesajlarÄ± yÃ¼kle
    async function loadMessages() {
      try {
        const res = await fetch("messages.json?t=" + Date.now());
        const msgs = await res.json();
        const list = document.getElementById("msgList");
        list.innerHTML = "";

        msgs.forEach(m => {
          const li = document.createElement("li");
          li.textContent = `${m.name}: ${m.text}`;
          list.appendChild(li);
        });

        if (msgs.length > 0) document.getElementById("ping").play().catch(()=>{});
      } catch(e) {
        console.warn("Mesajlar yÃ¼klenemedi.");
      }
    }

    setInterval(loadMessages, 20000);
    loadMessages();
  </script>
</body>
</html>
