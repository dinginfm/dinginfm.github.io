<?php
// 1) VERÄ°TABANI BAÄžLANTISI VE TABLO OLUÅžTURMA
$host  = 'localhost';
$dbname = 'dinginfm';
$user  = 'dinginfm_user';
$pass  = 'STRONG_PASSWORD'; // Kendi ÅŸifrenle deÄŸiÅŸtir

try {
    $db = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8mb4", $user, $pass, [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION
    ]);

    // Mesajlar tablosunu otomatik oluÅŸturur
    $db->exec("CREATE TABLE IF NOT EXISTS messages (
        id INT AUTO_INCREMENT PRIMARY KEY,
        sender_name VARCHAR(255),
        sender_email VARCHAR(255),
        message TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;");

} catch (PDOException $e) {
    die("BaÄŸlantÄ± hatasÄ±: " . $e->getMessage());
}

// 2) MESAJ GÃ–NDERME
$msg_status = "";
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['send_msg'])) {
    $name    = trim((string)($_POST['name'] ?? ""));
    $email   = trim((string)($_POST['email'] ?? ""));
    $content = trim((string)($_POST['message'] ?? ""));

    // Temel temizlik
    $name_clean = htmlspecialchars($name, ENT_QUOTES, 'UTF-8');
    $email_clean = htmlspecialchars($email, ENT_QUOTES, 'UTF-8');
    $content_clean = htmlspecialchars($content, ENT_QUOTES, 'UTF-8');

    if ($name_clean !== "" && $content_clean !== "") {
        $stmt = $db->prepare("INSERT INTO messages (sender_name, sender_email, message) VALUES (?, ?, ?)");
        $stmt->execute([$name_clean, $email_clean, $content_clean]);
        $msg_status = "success";
    }
}

// 3) ADMIN MESAJLARI (HERKESE AÃ‡IK OLMASIN)
// Admin gÃ¶rmek iÃ§in: connect.php?admin=1
$show_admin = (isset($_GET['admin']) && $_GET['admin'] === '1');

$all_messages = [];
if ($show_admin) {
    $all_messages = $db->query("SELECT * FROM messages ORDER BY created_at DESC")->fetchAll(PDO::FETCH_ASSOC);
}
?>
<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dingin FM | Ä°letiÅŸim</title>

<style>
*{box-sizing:border-box}
:root{--fm-title:#6fc9ff}

html,body{
    margin:0;
    height:100%;
    font-family:'Segoe UI',sans-serif;
    color:#fff;
}

/* âœ… LOGO PNG TAM SAYFA */
body{
    background: url("logo.png") center center no-repeat fixed;
    background-size: cover;
    overflow-x:hidden;
}

/* âœ… Okunabilirlik iÃ§in hafif karartma */
.overlay{
    position:fixed;
    inset:0;
    z-index:1;
    background:
        radial-gradient(circle at center, rgba(0,0,0,.06) 0%, rgba(0,0,0,.55) 85%),
        linear-gradient(to bottom, rgba(0,0,0,.50) 0%, rgba(0,0,0,.15) 40%, rgba(0,0,0,.55) 100%);
}

/* Header */
header{
    position:fixed;
    top:0; left:0;
    width:100%;
    z-index:99;
    padding:12px;
    background:rgba(0,0,0,.40);
    backdrop-filter:blur(10px);
    -webkit-backdrop-filter:blur(10px);
    border-bottom:1px solid rgba(255,255,255,.10);
    text-align:center;
}

nav a{
    color:#fff;
    text-decoration:none;
    margin:0 10px;
    font-weight:800;
    font-size:14px;
    opacity:.85;
}
nav a:hover{opacity:1}
nav a.active{
    color:var(--fm-title);
    border-bottom:2px solid var(--fm-title);
    padding-bottom:4px;
}

/* Main */
main{
    position:relative;
    z-index:2;
    width:100%;
    margin:0 auto;
    padding:90px 18px 90px;
}

/* âœ… Panel kÃ¼Ã§Ã¼ldÃ¼ (logo daha Ã§ok gÃ¶zÃ¼ksÃ¼n) */
.panel{
    width:min(420px, 92%);
    margin:0 auto;
    background:rgba(0,0,0,.48);
    border:1px solid rgba(255,255,255,.12);
    border-radius:22px;
    padding:18px;
    backdrop-filter:blur(14px);
    -webkit-backdrop-filter:blur(14px);
    box-shadow:0 25px 55px rgba(0,0,0,.35);
}

.contact-info{
    margin-bottom:8px;
    font-size:17px;
    font-weight:900;
    color:var(--fm-title);
    text-align:center;
}

/* âœ… mail + instagram */
.contact-mini{
    margin: 0 0 14px 0;
    padding: 10px 12px;
    border-radius: 14px;
    background: rgba(255,255,255,.06);
    border: 1px solid rgba(255,255,255,.12);
    font-size: 13px;
    line-height: 1.6;
    color: rgba(255,255,255,.85);
    text-align:left;
}
.contact-mini b{
    color:#fff;
}

form input, form textarea{
    width:100%;
    padding:11px 12px;
    margin-bottom:10px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.18);
    background:rgba(255,255,255,.06);
    color:#fff;
    outline:none;
    font-size:14px;
}
form textarea{resize:none}
form input:focus, form textarea:focus{
    border-color:rgba(111,201,255,.55);
}

/* âœ… BUTON ARTIK LOGOYU KAPAMAYACAK (dar + ortada) */
.btn{
    display:block;
    width:220px;
    max-width:100%;
    margin:10px auto 0;
    padding:11px 16px;
    border-radius:999px;
    border:none;
    background:var(--fm-title);
    color:#000;
    font-weight:900;
    cursor:pointer;
    letter-spacing:.6px;
    font-size:13px;
}

.admin-section{margin-top:26px; text-align:left;}
.msg-box{
    background:rgba(255,255,255,.06);
    padding:14px;
    border-radius:12px;
    margin-bottom:10px;
    border-left:4px solid var(--fm-title);
}
.msg-box strong{color:var(--fm-title); display:block; margin-bottom:6px;}
.msg-box small{opacity:.65}

/* Footer */
footer{
    position:fixed;
    left:0;
    bottom:0;
    width:100%;
    z-index:99;
    padding:12px 10px;
    text-align:center;
    font-size:12px;
    background:rgba(0,0,0,.35);
    backdrop-filter:blur(8px);
    -webkit-backdrop-filter:blur(8px);
    border-top:1px solid rgba(255,255,255,.10);
    color:rgba(255,255,255,.70);
}
</style>
</head>

<body>

<div class="overlay"></div>

<header>
    <nav>
        <a href="index.html">Ana Sayfa</a>
        <a href="connect.php" class="active">Ä°letiÅŸim</a>
    </nav>
</header>

<main>
    <div class="panel">
        <div class="contact-info">ðŸ“© Ä°letiÅŸim & Ä°stek HattÄ±</div>

        <div class="contact-mini">
            <div><b>Mail:</b> dinginfm@gmail.com</div>
            <div><b>Instagram:</b> dinginfm</div>
        </div>

        <?php if($msg_status === "success"): ?>
            <p style="color:#4caf50; font-weight:800; text-align:center;">âœ… MesajÄ±nÄ±z baÅŸarÄ±yla gÃ¶nderildi!</p>
        <?php endif; ?>

        <form method="POST">
            <input type="text" name="name" placeholder="AdÄ±nÄ±z / LakabÄ±nÄ±z" required>
            <input type="email" name="email" placeholder="E-posta (Opsiyonel)">
            <textarea name="message" rows="4" placeholder="MesajÄ±nÄ±z..." required></textarea>
            <button type="submit" name="send_msg" class="btn">GÃ–NDER</button>
        </form>

        <?php if($show_admin): ?>
            <div class="admin-section">
                <h3 style="border-bottom:1px solid rgba(255,255,255,.12); padding-bottom:10px; margin-top:20px;">
                    ðŸ“¥ Gelen Son Mesajlar
                </h3>

                <?php if(empty($all_messages)): ?>
                    <p style="opacity:.75;">HenÃ¼z mesaj yok.</p>
                <?php else: ?>
                    <?php foreach($all_messages as $m): ?>
                        <div class="msg-box">
                            <strong>
                                <?= htmlspecialchars($m['sender_name'] ?? '', ENT_QUOTES, 'UTF-8') ?>
                                <small>
                                    (<?= htmlspecialchars($m['sender_email'] ?? '', ENT_QUOTES, 'UTF-8') ?>)
                                </small>
                            </strong>
                            <p><?= nl2br(htmlspecialchars($m['message'] ?? '', ENT_QUOTES, 'UTF-8')) ?></p>
                            <small><?= htmlspecialchars($m['created_at'] ?? '', ENT_QUOTES, 'UTF-8') ?></small>
                        </div>
                    <?php endforeach; ?>
                <?php endif; ?>
            </div>
        <?php endif; ?>

    </div>
</main>

<footer>
    Â© 2025 Dingin FM â€” SessizliÄŸin Sesi Burada. TÃ¼m haklarÄ± saklÄ±dÄ±r.
</footer>

</body>
</html>
