<?php
// 1. VERÄ°TABANI BAÄžLANTISI VE TABLO OLUÅžTURMA
$host = 'localhost';
$dbname = 'dinginfm';
$user = 'dinginfm_user';
$pass = 'STRONG_PASSWORD'; // Kendi ÅŸifrenle deÄŸiÅŸtir

try {
    $db = new PDO("mysql:host=$host;dbname=$dbname;charset=utf8mb4", $user, $pass, [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION
    ]);

    // Mesajlar tablosunu otomatik oluÅŸturur
    $db->exec("CREATE TABLE IF NOT EXISTS messages (
        id INT AUTO_INCREMENT PRIMARY KEY,
        sender_name VARCHAR(255),
        sender_email VARCHAR(255),
        message TEXT,
        created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;");

} catch (PDOException $e) {
    die("BaÄŸlantÄ± hatasÄ±: " . $e->getMessage());
}

// 2. MESAJ GÃ–NDERME Ä°ÅžLEMÄ°
$msg_status = "";
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['send_msg'])) {
    $name = htmlspecialchars($_POST['name']);
    $email = htmlspecialchars($_POST['email']);
    $content = htmlspecialchars($_POST['message']);

    if (!empty($name) && !empty($content)) {
        $stmt = $db->prepare("INSERT INTO messages (sender_name, sender_email, message) VALUES (?, ?, ?)");
        $stmt->execute([$name, $email, $content]);
        $msg_status = "success";
    }
}

// 3. MESAJLARI Ã‡EKME (Admin iÃ§in)
$all_messages = $db->query("SELECT * FROM messages ORDER BY created_at DESC")->fetchAll(PDO::FETCH_ASSOC);
?>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dingin FM | Ä°letiÅŸim & Mesajlar</title>
    <style>
        *{box-sizing:border-box}
        :root{--fm-title:#6fc9ff}
        html,body{margin:0;height:100%; background:#0a1118; color:#fff; font-family:'Segoe UI',sans-serif;}
        
        /* LOGO ARKA PLAN */
        .logo-bg{
            position:fixed; inset:0; z-index:0;
            background:url("logo.png") center bottom no-repeat;
            background-size:cover; opacity:.4; pointer-events:none;
        }

        header{
            position:fixed; top:0; left:0; width:100%; z-index:99;
            padding:12px; background:rgba(0,0,0,.5); backdrop-filter:blur(10px);
            border-bottom:1px solid rgba(255,255,255,.1); text-align:center;
        }

        nav a{color:#fff; text-decoration:none; margin:0 10px; font-weight:700; font-size:14px;}
        nav a.active{color:var(--fm-title); border-bottom:2px solid var(--fm-title);}

        main{position:relative; z-index:2; max-width:600px; margin:0 auto; padding:100px 20px 50px;}

        .panel{
            background:rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.1);
            border-radius:20px; padding:25px; backdrop-filter:blur(15px);
        }

        .contact-info{margin-bottom:20px; font-size:18px; font-weight:bold; color:var(--fm-title);}

        form input, form textarea {
            width:100%; padding:12px; margin-bottom:10px; border-radius:10px;
            border:1px solid rgba(255,255,255,0.2); background:rgba(255,255,255,0.05); color:#fff;
        }

        .btn{
            width:100%; padding:12px; border-radius:10px; border:none;
            background:var(--fm-title); color:#000; font-weight:bold; cursor:pointer;
        }

        /* ADMIN MESAJ LÄ°STESÄ° */
        .admin-section{margin-top:40px; text-align:left;}
        .msg-box{
            background:rgba(255,255,255,0.05); padding:15px; border-radius:10px;
            margin-bottom:10px; border-left:4px solid var(--fm-title);
        }
        .msg-box strong{color:var(--fm-title); display:block;}
        .msg-box small{opacity:0.6;}
    </style>
</head>
<body>

<div class="logo-bg"></div>

<header>
    <nav>
        <a href="index.html">Ana Sayfa</a>
        <a href="connect.php" class="active">Ä°letiÅŸim</a>
    </nav>
</header>

<main>
    <div class="panel">
        <div class="contact-info">ðŸ“© Ä°letiÅŸim & Ä°stek HattÄ±</div>
        
        <?php if($msg_status == "success"): ?>
            <p style="color:#4caf50;">âœ… MesajÄ±nÄ±z baÅŸarÄ±yla gÃ¶nderildi!</p>
        <?php endif; ?>

        <form method="POST">
            <input type="text" name="name" placeholder="AdÄ±nÄ±z / LakabÄ±nÄ±z" required>
            <input type="email" name="email" placeholder="E-posta (Opsiyonel)">
            <textarea name="message" rows="4" placeholder="MesajÄ±nÄ±z..." required></textarea>
            <button type="submit" name="send_msg" class="btn">GÃ–NDER</button>
        </form>

        <div class="admin-section">
            <h3 style="border-bottom:1px solid #333; padding-bottom:10px;">ðŸ“¥ Gelen Son Mesajlar</h3>
            <?php foreach($all_messages as $m): ?>
                <div class="msg-box">
                    <strong><?= htmlspecialchars($m['sender_name']) ?> <small>(<?= $m['sender_email'] ?>)</small></strong>
                    <p><?= nl2br(htmlspecialchars($m['message'])) ?></p>
                    <small><?= $m['created_at'] ?></small>
                </div>
            <?php endforeach; ?>
        </div>
    </div>
</main>

</body>
</html>
